{% extends "base.html" %}
{% load l10n %}
{% load pagination_tags %}
{% load sorting_tags %}
{% load ads_tag %}
{% load utils_tags %}

{% block media %}
	{{ filter.form.media }}
	<script>
		$(document).ready(function(){
			// init less important parameters
			$('.atom_content').each(function(index) {
				//console.log($(this).find('.has_value').length)
				if($(this).find('.has_value').length == 0){
					$(this).hide('fast')
				}else {
					$(this).parent().find('.icon').removeClass('plus').addClass('cross')
				}
			})
			$('.extend').click(function(evt){
				/*
				if($(this).find('.icon').hasClass('plus')){
					$(this).find('.icon').removeClass('plus').addClass('cross')
					$(this).parent().next().show()
				}else{
					$(this).find('.icon').addClass('plus').removeClass('cross')
					$(this).parent().next().find(':input').val('').removeAttr('checked').removeAttr('selected')
					$(this).parent().next().hide()
				}
				*/
				if($(this).html() == '+'){
					$(this).html('-')
					$(this).parent().next().show('fast')
				}else{
					$(this).html('+')
					$(this).parent().next().find(':input').val('').removeAttr('checked').removeAttr('selected')
					$(this).parent().next().hide('fast')
				}
			})
    	});
	</script>

{% endblock %}


{% block content %}

	{{ filter.form.errors }}

    <form action="{% url search %}" method="POST" id="search">
		{% csrf_token %}
		{% if filter.form.non_field_errors %}{{ filter.form.non_field_errors }}{% endif %}
	
	<div  class="search_form" style="padding:10px; float:right;width:245px; border-top-right-radius:10px;border-bottom-right-radius:10px;border-bottom-left-radius:10px;">
		
		<!-- FORM ACTIONS -->
		<div style="text-align:center;padding:8px;">
		<button type="submit" value="search" name="search"><span class="magnifier icon"></span>Chercher</button>
		<a class="button" href="{% url search %}"><span class="cross icon"></span>Initialiser</a>
		{% if user.is_authenticated %}
        <button type="submit" value="save and search" name="save_and_search" class="button"><span class="pen icon"></span>Sauver</button>
		{% else %}
		<br />Pour sauvegarder vos recherches, <a href="{% url userena_signup %}">inscrivez-vous</a> ou <a href="{% url userena_signin %}">connectez-vous</a>.
		{% endif %}	
		</div>		
		
		
		<!-- NON LOCATION FIELDS -->	
		{% for fieldset in filter.form.fieldsets %}
			{% if fieldset.name != 'location' %}
			<div class="atom {{ fieldset.classes }}">
				{% if fieldset.legend != fieldset.name %}
				<h3 class="atom_title"><a class="extend">+</span></a> <!-- <a class="pill button extend"><span class="plus icon"></span></a> -->{{ fieldset.legend }}</h3>
				{% else %}
				{% endif %}
				<div class='{% if fieldset.legend != fieldset.name %}atom_content{% endif %}'>
					{% if fieldset.description %}
					<p class="description">{{ fieldset.description }}</p>
					{% endif %}
						<table>
							{% for field in fieldset %}
								{% if field.is_hidden %}
									{{ field }}
								{% else %}
									<tr{{ field.row_attrs }}>
										<td>{{ field.label_tag }} </td>
										<td class="{% has_value field %}">
											{{ field }}
											{% if field.help_text %}<br />{% autoescape off %}<span class="help">{{ field.help_text }}</span>{% endautoescape %}{% endif %}
											{% if field.errors %}<br />{{ field.errors }}{% endif %}
										</td>
									</tr>
								{% endif %}
							{% endfor %}
						</table>
				</div>
			</div>
			{% endif %}
		{% endfor %}
	</div>
		
	<div style="margin-right:265px; " >
		
		<div class="search_form" style="padding:10px; padding-right:0px; border-top-left-radius:10px;border-bottom-left-radius:10px;">
		<!-- LOCATION FIELD -->
		<div class="atom {{ fieldset.classes }}" style="height:500px">
			<h2>{{ filter.form.fieldsets.location.legend }}</h2>
			<p class="description">{{ filter.form.fieldsets.location.description }}</p>
			{% for field in filter.form.fieldsets.location %}
				{% if field.is_hidden %}
					{{ field }}
					{% else %}
					<div style="padding:2px">{{ field }} <br />{{ field.errors }}</div>
					{% endif %}
			{% endfor %}
		</div>
		
		</div>
				

		<!-- RESULTS -->
		{% if search %}
		<div id="results" style="padding:10px; padding-right:15px;">
		
		
		
		{% if filter.qs %}
		
		{% autosort filter.qs as sorted_objects %}
		{% autopaginate sorted_objects 10 as object_list %}
		
		<div class="atom" >
			<h2>Résultats de la recherche</h2>
			<table>
				<tr class="result_header">
					<th></th>
					<th>{% anchor price "Prix" %}</th>
					<th>{% anchor surface "Surface" %}</th>
					<th>{% anchor habitation_type "Type de bien" %}</th>
					<th>{% anchor nb_of_rooms "Nb. de pièces" %}</th>
					<th>{% anchor nb_of_bedrooms "Nb. chambres" %}</th>
				</tr>
				{% for ad in object_list %}
				<tr class="{% cycle 'odd' 'even' %}">
					<td class="ad_title"><a href="{% url view ad.id %}">{{ ad.title }}</a></td>
					<td>{{ ad.price }}</td>
					<td>{{ ad.surface }}</td>
					<td>{{ ad.get_habitation_type_display }}</td>
					<td>{{ ad.nb_of_rooms }}</td>
					<td>{{ ad.nb_of_bedrooms }}</td>
				</tr>
				{% endfor %}
			</table>
			{% paginate %}
		</div>
		{% else  %}
		<div class="atom" >
			<h2>Pas d'annonces correspondant à votre recherche</h2>
		</div>
		{% endif %}
		</div>
		
		{% endif %}
		
	</div>
		
		
    </form>

	
		{% comment %}
		{% endcomment %}


{% endblock %}