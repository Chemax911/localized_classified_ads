{% extends "base.html" %}
{% load ads_tag %}

{% block title %}{{ site.name }} | Proposer un bien{% endblock %}

{% block media %}
	{{ form.media }}
{% endblock %}

{% block javascript %}
	<script>
		$(document).ready(function(){
			var habitation_type = $('#id_habitation_type').val();
			var correspondance = ['apartment', 'house', '', '', '', '', '', 'parking', 'others'];
			//var habitation_type_display = correspondance[parseInt(habitation_type)]
			function init_form(){
				$('.atom').each(function(evt){
					console.log($(this), habitation_type)
					if(habitation_type != ''){
						if(!$(this).hasClass(correspondance[parseInt(habitation_type)])){
							$(this).hide()
							// erase values
							$(this).find(':input').val('').removeAttr('checked').removeAttr('selected')
						}else{
							$(this).show()
						}
					}
					else{
						if(!$(this).hasClass('base')){
							$(this).hide()
						}
					}
				})
			}
						
			$('#id_habitation_type').change(function(evt){
				habitation_type = $(this).val()
				//habitation_type_display = correspondance[parseInt(habitation_type)]
				//console.log(habitation_type_display)
				init_form()
			})
			
			init_form()
		})
	</script>
{% endblock %}


{% block main_menu %}
	<a href="{% url search %}" class="main_menu_item_unselected">Rechercher un bien</a>
	<a href="{% url add %}" class="main_menu_item_selected" >Proposer un bien</a>
{% endblock %}

{% block content %}
	<form action="" method="POST" class="pretty_form" enctype="multipart/form-data">
	<div class="form">
		{% csrf_token %}	
		{% if form.non_field_errors %}{{ form.non_field_errors }}{% endif %}
		{% for fieldset in form.fieldsets %}
		  {% if fieldset.name != 'description' %}
		    
		  <div class="atom {{ fieldset.classes }}">
		  {% if fieldset.legend %}
		    <h2 class="hightlight_title">{{ fieldset.legend }}</h2>
		  {% endif %}
		  {% if fieldset.description %}
		    <p class="description">{{ fieldset.description }}</p>
		  {% endif %}
		  <table>
		  {% for field in fieldset %}
			{% if field.is_hidden %}
		      {{ field }}
		    {% else %}
			{% ifequal field.name 'location' %}
			
			<tr>
				<th>{{ field.label_tag }}</th>
				<td>
				<div >{{ field }} 
					{% if field.help_text %}<br />
						{% autoescape off %}<span class="help">{{ field.help_text }}</span>{% endautoescape %}
						{% endif %}
						{% if field.errors %}<br />{{ field.errors }}{% endif %}	
					</div>
					<div style="clear:both"></div>
				</td>
			</tr>
			
			{% else %}
		      <tr{{ field.row_attrs }}>
		        <th>
					{{ field.label_tag }}
				</th>
		        <td>
					{{ field }} 
					{% if field.errors %}<br />{{ field.errors }} {% endif %}
					{% if field.help_text %}<br />
						{% autoescape off %}<span class="help">{{ field.help_text }}</span>{% endautoescape %}
					{% endif %}
				</td>
		      </tr>
		    {% endifequal %}
		    {% endif %}
		  	{% endfor %}

		  </table>
		  </div>
			{% endif %}
		{% endfor %}

		<div class="atom house apartment parking others">
			<h2 class="hightlight_title">Photos</h2>
			<p>N'hésitez pas à insérer une photo du plan de votre bien.</p>
			    {{ picture_formset.management_form }}
    		<ul style="list-style:none">
        		{% for form in picture_formset %}
        		<li class="upload_picture">
					{% comment %}{{ form.id }} {{ form.DELETE }} {{ form.title }} {{ form.image }} {% endcomment %}
					<table>{{ form }}</table>
				</li>
        		{% endfor %}
    		</ul>
		</div>
		<div style="clear:both"></div>
		
		<div class="atom {{ form.fieldsets.description.classes }}">
			<h2 class="hightlight_title">{{ form.fieldsets.description.legend }}</h2>
		  <table>
		  {% for field in form.fieldsets.description %}
			{% if field.is_hidden %}
		      {{ field }}
		    {% else %}
			
		      <tr{{ field.row_attrs }}>
		        <td>
					{{ field.label_tag }}
				</td>
		        <td>
					{{ field }} 
					{% if field.errors %}<br />{{ field.errors }} {% endif %}
					{% if field.help_text %}<br />
						{% autoescape off %}<span class="help">{{ field.help_text }}</span>{% endautoescape %}
					{% endif %}
				</td>
		      </tr>
		    {% endif %}
		  	{% endfor %}
		  </table>
		</div>


        <button type="submit" />Envoyer</button>
	</div>
    </form>
{% endblock %}