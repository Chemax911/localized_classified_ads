{% extends "base.html" %}
{% load ads_tag %}
{% load l10n %}

{% block javascript %}
	<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
	
	<link rel="stylesheet" media="all" type="text/css" href="{{ STATIC_URL }}css/map.css">
	<script src="{{ STATIC_URL }}js/OpenLayers.js"></script>

	
	<script src="{{ STATIC_URL }}js/jquery.tools.min.js"></script>
	
	<script>
	    $(document).ready(function(){

			var layer_style = OpenLayers.Util.extend({}, OpenLayers.Feature.Vector.style['default']);
			layer_style.fillOpacity = 0.2;
			layer_style.graphicOpacity = 1; 
					
			var style_blue = OpenLayers.Util.extend({}, layer_style);
			style_blue.strokeColor = "blue";
			style_blue.fillColor = "#3BB9FF";
			style_blue.graphicName = "circle";
			style_blue.pointRadius = 10;
			style_blue.strokeWidth = 2;
			style_blue.strokeLinecap = "butt";
			style_blue.externalGraphic = "/static/img/home_icon.png";

            var map;
            map = new OpenLayers.Map('map');
            map.addControl(new OpenLayers.Control.LayerSwitcher());

            var proj = new OpenLayers.Projection("EPSG:4326");

            var gmap = new OpenLayers.Layer.Google("Google Streets", {
                sphericalMercator: true,
                'maxExtent': new OpenLayers.Bounds(-20037508.34, -20037508.34, 20037508.34, 20037508.34)
            });
            var pointLayer = new OpenLayers.Layer.Vector("Point Layer");

            map.addLayers([gmap, pointLayer]);
            var lonlat = new OpenLayers.LonLat({{ ad.location.coords.0|unlocalize }}, {{ ad.location.coords.1|unlocalize }});
            //lonlat.transform(proj, map.getProjectionObject());
            map.setCenter(lonlat, 15);

            var point = new OpenLayers.Geometry.Point({{ ad.location.coords.0|unlocalize }}, {{ ad.location.coords.1|unlocalize }});


            var pointFeature = new OpenLayers.Feature.Vector(point, null, style_blue);
            pointLayer.addFeatures([pointFeature]);


			$("img[rel]").overlay();

    	});
	</script>
{% endblock %}

{% block css %}
 <style type="text/css">
/* the overlayed element */
.simple_overlay {
	
	/* must be initially hidden */
	display:none;
	
	/* place overlay on top of other elements */
	z-index:10000;
	
	/* styling */
	background-color:#333;
	
	width:675px;	
	min-height:200px;
	border:1px solid #666;
	
	/* CSS3 styling for latest browsers */
	-moz-box-shadow:0 0 90px 5px #000;
	-webkit-box-shadow: 0 0 90px #000;	
}

.simple_overlay img {
	max-width:675px;
}

/* close button positioned on upper right corner */
.simple_overlay .close {
	background-image:url('{{ STATIC_URL }}/img/close.png');
	position:absolute;
	right:-15px;
	top:-15px;
	cursor:pointer;
	height:35px;
	width:35px;
}

</style>

{% endblock %}



{% block content %}

<div id="block_content">
	<!--<script>add_home({{ ad.location.coords.0|unlocalize }}, {{ ad.location.coords.1|unlocalize }}, "{% url view ad.id %}")</script>-->
	<h2>{{ ad.title }}</h2>
	<h2>
		{{ ad.get_habitation_type_display }}
		- {{ ad.price }}€
		- {{ ad.surface }}m<sup>2</sup>
		- {{ ad.nb_of_rooms }} pièces
		- {{ ad.nb_of_bedrooms }} chambres
	</h2>
	<br />
	{% for img in ad.pictures.all %}
		<div class="thumbnail">
		<img src="{% thumbnail img.image 200 130 %}" rel="#img_{{ img.id }}" />
		</div>
	{% endfor %}
	{% for img in ad.pictures.all %}
		<div class="simple_overlay" id="img_{{ img.id }}">
		<img src="{{ img.image.url }}"/>
		<br />
		<b style="color:white;padding-left:4px;">{{ img.title }}</b>
		</div>
	{% endfor %}
	
	
	
	<div style="clear:both"></div>
	{% comment %}{{ map_widget }}{% endcomment %}
	<div style="width:900px; height:300px" id="map"></div>
	<div style="clear:both"></div>
	<p>
		{{ ad.description|linebreaksbr  }}
	</p>
	<div class="atom">
		<h3>Critères énergétiques</h3>
		<p>
			Consommation énergétique : {{ ad.get_energy_consumption_display }}	
			<br />
			Emission de gaz à effets de serre : {{ ad.emission_of_greenhouse_gases }}
		</p>
		{% if ad.floor or ad.orientation %}
		<h3>Situation du logement</h3>
		<p>
		{{ ad.floor }}<sup>e</sup> étage {% if ad.top_floor %}(ce bien est situé au dernier étage){% endif %}
		<br />
		Orientation : {{ ad.get_orientation_display }}
		</p>
		{% endif %}

		{% if ad.elevator or ad.intercom or ad.digicode or ad.doorman %}
		<h3>A propos de l'immeuble</h3>
		<p>
		{% if ad.elevator %}Ascenseur<br />{% endif %}
		{% if ad.intercom %}Interphone<br />{% endif %}
		{% if ad.digicode %}Digicode<br />{% endif %}
		{% if ad.doorman %}Gardien{% endif %}
		</p>
		{% endif %}

		{% if ad.heating or ad.kitchen or ad.duplex or ad.swimming_pool or ad.alarm or ad.air_conditioning or ad.fireplace or ad.parquet or ad.terrace or ad.balcony %}
		<h3>Commodités</h3>
		<p>
		{% if ad.heating %}Chauffage : {{ ad.get_heating_display }}<br />{% endif %}
		{% if ad.kitchen %}Cuisine : {{ ad.get_kitchen_display }}<br />{% endif %}
		{% if ad.duplex %}Duplex<br />{% endif %}
		{% if ad.swimming_pool %}Piscine<br />{% endif %}
		{% if ad.alarm %}Alarme<br />{% endif %}
		{% if ad.air_conditioning %}Air conditionné<br />{% endif %}
		{% if ad.fireplace %}Cheminée<br />{% endif %}
		{% if ad.parquet %}Parquet<br />{% endif %}
		{% if ad.terrace %}Terrasse<br />{% endif %}
		{% if ad.balcony %}Balcon{% endif %}
		</p>
		{% endif %}

		{% if ad.separate_dining_room or ad.living_room or ad.separate_toilet or ad.bathroom or ad.shower or ad.separate_entrance %}
		<h3>Pièces</h3>
		<p>
		{% if ad.separate_dining_room %}Salle à manger séparée<br />{% endif %}
		{% if ad.living_room %}Salon<br />{% endif %}
		{% if ad.separate_toilet %}Toilette séparée<br />{% endif %}
		{% if ad.bathroom %}Salle de bain<br />{% endif %}
		{% if ad.shower %}Douche<br />{% endif %}
		{% if ad.separate_entrance %}Entrée séparée{% endif %}
		</p>
		{% endif %}

		{% if ad.cellar or ad.cupboards or ad.open_parking or ad.box %}
		<h3>Rangements</h3>
		<p>
		{% if ad.cellar %}Cave<br />{% endif %}
		{% if ad.cupboards %}Placards<br />{% endif %}
		{% if ad.open_parking %}Parking ouvert<br />{% endif %}
		{% if ad.box %}Boite{% endif %}	
		</p>
		{% endif %}
		</div>
	<p>
		<i>
			{% comment %}
			Annonce mise en ligne par <a href="{% url userena_profile_detail ad.user_profile.user.username %}">{{ ad.user_profile.user }}</a>
			<br />
			{% endcomment %}
			Date de création de l'annonce : {{ ad.create_date }}, date de mise à jour : {{ ad.update_date }}
		</i>
	</p>

</div>

<div class="atom">
{% if sent_mail %}
{% else %}

{% if user.is_authenticated %}
	<form action="" method="POST">
		<h3>Contacter le vendeur</h3>
	<table>
		{% csrf_token %}
		{{ contact_form.as_table }}
		<tr>
			<td></td>
			<td><button type="submit">Ecrire au vendeur</button></td>
		</tr>
	</table>
	</form>
{% else %}
	<div class="content">
		<p>Pour écrire au vendeur, <a href="{% url userena_signup %}">inscrivez-vous</a> ou <a href="{% url userena_signin %}">connectez-vous</a> !</p>
	</div>
{% endif %}

{% endif %}
</div>

{% endblock %}