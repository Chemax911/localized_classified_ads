{% extends "base.html" %}
{% load ads_tag %}
{% load i18n %}
{% load l10n %}

{% comment %}

{% block javascript %}
	<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<script src="http://openlayers.org/dev/OpenLayers.js"></script>
	<script>
	$(document).ready(function(){

		map = new OpenLayers.Map('map', 
					{
						projection: new OpenLayers.Projection('EPSG:900913'), 
						displayProjection: new OpenLayers.Projection('EPSG:4326'),
					}
				);

		renderer = OpenLayers.Util.getParameters(window.location.href).renderer;
		renderer = (renderer) ? [renderer] : OpenLayers.Layer.Vector.prototype.renderers; 
		var gmap = new OpenLayers.Layer.Google(
	    	"Google Streets", // the default
	    	{numZoomLevels: 20, sphericalMercator: true}
		);
		map.addLayer(gmap);
		var lonlat = new OpenLayers.LonLat({{ profile.location.coords.0|unlocalize }}, {{ profile.location.coords.1|unlocalize }})
		map.setCenter(lonlat, 12);
		
		layer_style = OpenLayers.Util.extend({}, OpenLayers.Feature.Vector.style['default']);
		layer_style.fillOpacity = 0.2;
		layer_style.graphicOpacity = 1; 

		vectorLayer = new OpenLayers.Layer.Vector("Simple Geometry", {
			style: layer_style,
			renderers: renderer,
			displayInLayerSwitcher: false,
		}); 
		
		map.addLayer(vectorLayer);

		var style_blue = OpenLayers.Util.extend({}, layer_style);
		style_blue.strokeColor = "blue";
		style_blue.fillColor = "#3BB9FF";
		style_blue.graphicName = "circle";
		style_blue.pointRadius = 10;
		style_blue.strokeWidth = 2;
		style_blue.strokeLinecap = "butt";
		style_blue.externalGraphic = "/static/img/marker-blue.png";
		style_blue.backgroundGraphic = "/static/img/marker_shadow.png";

		var point = new OpenLayers.Geometry.Point({{ profile.location.coords.0|unlocalize }}, {{ profile.location.coords.1|unlocalize }});
		var pointFeature = new OpenLayers.Feature.Vector(point,null,style_blue); 
		vectorLayer.addFeatures([pointFeature])
	});
	</script>
{% endblock %}

{% block css %}
<style type="text/css">
.olMap{
	width:100%;
	height:350px;
}
</style>
{% endblock %}

{% endcomment %}

{% block main_menu %}
{% endblock %}

{% block content %}



<div id="userena_profile_detail">
  {% if user.username == profile.user.username %}
	{% include "userena/menu_snippet.html" %}
  {% endif %}

<div id="block_content">

{% if user.is_authenticated %}

{% ifequal user.username profile.user.username %}

<h3>Votre Compte</h3>
	<p style="padding-top:5px">
		email : {{ user.email }}
		<br />
		{% if profile.phone_number %}Votre numéro de téléphone : {{ profile.phone_number }}<br />{% endif %}
		{% comment %}
		<div id="map_container"><div id="map" class="smallmap"></div></div>
		{% endcomment %}
	</p>
	
<p>
<a class="main_menu_item_unselected" href="{% url userena_profile_edit user.username %}" id="userena_profile_edit_menu_item">{% trans "Edit profile" %}</a>
<a class="main_menu_item_unselected" href="{% url userena_password_change user.username %}" id="userena_password_change_menu_item">{% trans "Change password" %}</a>
<a class="main_menu_item_unselected" href="{% url userena_email_change user.username %}" id="userena_email_change_menu_item">{% trans "Change email" %}</a>

</p>

{% endifequal %}

{% endif %}

{% if all_user_ads %}
<div class="atom">
<br />
<h3>Vos Biens en ventes</h3>
<table>
{% for ad in all_user_ads %}
    {% if ad.delete_date == None %}
	<tr class="status_{{ ad.moderated_object.moderation_status}}" >
		<td style="border-bottom:2px solid white;"><a href="{% url view ad.id %}">{% include 'ads/resume.html' %}</a></td>
		<td style="border-bottom:2px solid white;">
			{% if ad.moderated_object.moderation_status == 0 %}Annonce rejetée. Modifiez-la pour la soumettre de nouveau.{% endif %}
			{% if ad.moderated_object.moderation_status == 1 %}Annonce en ligne{% endif %}
			{% if ad.moderated_object.moderation_status == 2 %}Annonce en cours de modération{% endif %}
		</td>
		<td style="border-bottom:2px solid white;"><a href="{% url edit ad.id %}" class="pill button"><span class="pen icon"></span>Modifier</a></td>
		<td style="border-bottom:2px solid white;"><a href="{% url delete ad.id %}" class="negative pill button"><span class="cross icon"></span>Supprimer</a></td>
	</tr>
	{% endif %}
{% endfor %}
</table>
</div>
<br />
{% else %}
	{% if ads %}
	<div class="atom">
		<h3>Bien de ce vendeur en ventes</h3>
		<table>
			{% for ad in ads %}
			{% if ad.moderated_object.moderation_status == 1 and ad.delete_date == None %}
			<tr>
				<td><a href="{% url view ad.id %}">{% include 'ads/resume.html' %}</a> </td>
			</tr>
			{% endif %}
			{% endfor %}
		</table>
	</div>
	{% else %}
	<div class="atom">
		{% ifequal user.username profile.user.username %}
		<h3>Vous n'avez aucun bien en vente visible sur le site</h3>
		<p>Pour ajouter un bien en vente, cliquez <a href="{% url add %}">ici</a>.</p>
		{% endifequal %}
	</div>
	{% endif %}
<br />
{% endif %}

{% if searchs %}
<div class="atom">
	<h3>Vos Recherches</h3>
	<table>
	{% for search in searchs %}
		<tr>
			<td><a href="{% url search search.id %}" class="button">
				{% autoescape off %}{{ search }}{% endautoescape %}
			</a>
			</td>
			<td>
			<a href="{% url delete_search search.id %}" class="negative button">
				Supprimer cette recherche
			</a>
			</td>
		</tr>
	{% endfor %}
	</table>
</div>
<br />
{% endif %}



</div>

</div>

{% endblock %}